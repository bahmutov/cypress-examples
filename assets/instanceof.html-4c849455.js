import{_ as o,M as c,p as i,q as u,Q as e,R as s,t as n,N as p,a1 as a}from"./framework-e03faf0e.js";const l={},d=a('<h1 id="be-very-careful-with-instanceof-assertion" tabindex="-1"><a class="header-anchor" href="#be-very-careful-with-instanceof-assertion" aria-hidden="true">#</a> Be very careful with instanceof assertion</h1><p>When working with Cypress tests there are 3 different <code>window</code> and <code>document</code> objects. You are mostly interested in the application&#39;s <code>window</code> and <code>document</code>, while your tests execute in the spec&#39;s <code>window</code> space. Thus if you grab an HTML DOM element from the application and check if it&#39;s an instance of <code>HTMLElement</code> you will get <code>false</code> - because you are using the <code>HTMLElement</code> from the spec&#39;s <code>window</code> globals.</p>',2),k=a(`<div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Joe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;#name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ðŸš¨ INCORRECT, WILL FAIL, JUST A DEMO</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>$el<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;is element&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>HTMLDivElement<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When you use globals like <code>HTMLDivElement</code> they are automatically looked up from the <code>window</code> object. Thus we need to use the correct <code>window.HTMLDivElement</code> when confirming the instance of an element that comes from the application&#39;s iframe.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cy<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;**window.HTMLDivElement**&#39;</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">win</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;#name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// âœ… a DOM element retrieved from the application&#39;s window</span>
    <span class="token comment">// is an instance of that window&#39;s HTMLDivElement</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>$el<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;is element&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>
      win<span class="token punctuation">.</span>HTMLDivElement<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you want to construct new DOM elements with proper prototype, you need to use the application&#39;s <code>document</code>.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cy<span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// the constructed DIV is NOT an element</span>
  <span class="token comment">// from the spec&#39;s own window</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">&#39;spec&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>not<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>HTMLDivElement<span class="token punctuation">)</span>
  <span class="token comment">// check the constructed element against the app&#39;s iframe</span>
  cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">win</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">&#39;app window&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>
      win<span class="token punctuation">.</span>HTMLDivElement<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),r={href:"https://youtu.be/5VJOpg09w2k",target:"_blank",rel:"noopener noreferrer"},m=s("h2",{id:"using-the-with-statement",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#using-the-with-statement","aria-hidden":"true"},"#"),n(' Using the "with" statement')],-1),v=s("code",null,"instanceof",-1),h=s("code",null,"HTMLDivElement",-1),g=s("code",null,"HTMLDivElement",-1),b=s("code",null,"window",-1),f={href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/with",target:"_blank",rel:"noopener noreferrer"},w=s("code",null,"with",-1),y=s("strong",null,"do not recommend doing this",-1),_=s("code",null,"with",-1),T=a(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cy<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;**with window**&#39;</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// get the application&#39;s window and use with(window)</span>
  <span class="token comment">// to look up the correct &quot;HTMLDivElement&quot; when needed</span>
  <span class="token keyword">with</span> <span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;#name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>$el<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;is element&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>
        HTMLDivElement<span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Looking up <code>cy.window</code> every time you need to use it might be annoying. You can probably get away with fetching it from the internal <code>cy.state</code> object; that is a synchronous operation.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cy<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;**cy.state(window)**&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> win <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token string">&#39;window&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token punctuation">(</span>win<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;#name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>$el<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;is element&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>HTMLDivElement<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3);function x(L,E){const t=c("ExternalLinkIcon");return i(),u("div",null,[d,e(" fiddle instanceof example "),k,s("p",null,[n("Watch the video "),s("a",r,[n("Correctly Using instanceof Assertion In Cypress Test"),p(t)]),n(".")]),m,s("p",null,[n('There is one other way to "trick" the '),v,n(" check to use the right "),h,n(". By default, JavaScript engine looks up non-local reference like "),g,n(" in the global object, which in this case is the wrong "),b,n(". You can override the lookup, and force the JS engine to use a given object via the "),s("a",f,[w,n(" statement"),p(t)]),n(". I "),y,n(", as using the "),_,n(" statement can lead to weird behavior and hard to debug bugs. But I want to give you the complete picture, so here it is:")]),T,e(" fiddle-end ")])}const j=o(l,[["render",x],["__file","instanceof.html.vue"]]);export{j as default};
