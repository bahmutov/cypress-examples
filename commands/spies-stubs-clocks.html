<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spies, Stubs &amp; Clocks | Cypress examples (v12.5.1)</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <style>.action-focus.focus { border: 5px solid orange; } .hidden { display: none !important; }</style>
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <meta name="description" content="Static site with Cypress examples tested right from the Markdown sources">
    
    <link rel="preload" href="/cypress-examples/assets/css/0.styles.56615f06.css" as="style"><link rel="preload" href="/cypress-examples/assets/js/app.936f9c65.js" as="script"><link rel="preload" href="/cypress-examples/assets/js/3.c5f790ff.js" as="script"><link rel="preload" href="/cypress-examples/assets/js/28.5f523ed4.js" as="script"><link rel="prefetch" href="/cypress-examples/assets/js/10.0652b32a.js"><link rel="prefetch" href="/cypress-examples/assets/js/100.da5d7abb.js"><link rel="prefetch" href="/cypress-examples/assets/js/101.2344eaae.js"><link rel="prefetch" href="/cypress-examples/assets/js/102.0b564fd5.js"><link rel="prefetch" href="/cypress-examples/assets/js/103.f004065b.js"><link rel="prefetch" href="/cypress-examples/assets/js/104.0509bf38.js"><link rel="prefetch" href="/cypress-examples/assets/js/105.d159f969.js"><link rel="prefetch" href="/cypress-examples/assets/js/106.644c6b1e.js"><link rel="prefetch" href="/cypress-examples/assets/js/107.c3fd6a16.js"><link rel="prefetch" href="/cypress-examples/assets/js/108.fe5cf079.js"><link rel="prefetch" href="/cypress-examples/assets/js/109.a2018f97.js"><link rel="prefetch" href="/cypress-examples/assets/js/11.8ef0eb2d.js"><link rel="prefetch" href="/cypress-examples/assets/js/110.eee329b1.js"><link rel="prefetch" href="/cypress-examples/assets/js/111.81356291.js"><link rel="prefetch" href="/cypress-examples/assets/js/112.a2a9e62b.js"><link rel="prefetch" href="/cypress-examples/assets/js/113.281904c9.js"><link rel="prefetch" href="/cypress-examples/assets/js/114.2872001d.js"><link rel="prefetch" href="/cypress-examples/assets/js/115.684d6b66.js"><link rel="prefetch" href="/cypress-examples/assets/js/116.2c926f8b.js"><link rel="prefetch" href="/cypress-examples/assets/js/117.ce42f0de.js"><link rel="prefetch" href="/cypress-examples/assets/js/118.b0ef0fff.js"><link rel="prefetch" href="/cypress-examples/assets/js/119.d6b03360.js"><link rel="prefetch" href="/cypress-examples/assets/js/12.5bcb8d60.js"><link rel="prefetch" href="/cypress-examples/assets/js/120.f0a25da6.js"><link rel="prefetch" href="/cypress-examples/assets/js/121.9459bc2e.js"><link rel="prefetch" href="/cypress-examples/assets/js/122.2bdbbdd4.js"><link rel="prefetch" href="/cypress-examples/assets/js/123.b9401884.js"><link rel="prefetch" href="/cypress-examples/assets/js/124.97dbe5de.js"><link rel="prefetch" href="/cypress-examples/assets/js/125.aa828c81.js"><link rel="prefetch" href="/cypress-examples/assets/js/126.87a939b8.js"><link rel="prefetch" href="/cypress-examples/assets/js/127.adebaadb.js"><link rel="prefetch" href="/cypress-examples/assets/js/128.a00a6b3e.js"><link rel="prefetch" href="/cypress-examples/assets/js/129.c013cb0d.js"><link rel="prefetch" href="/cypress-examples/assets/js/13.741b0322.js"><link rel="prefetch" href="/cypress-examples/assets/js/130.8de0c927.js"><link rel="prefetch" href="/cypress-examples/assets/js/131.f61d6214.js"><link rel="prefetch" href="/cypress-examples/assets/js/132.77fd5ca8.js"><link rel="prefetch" href="/cypress-examples/assets/js/133.ab739811.js"><link rel="prefetch" href="/cypress-examples/assets/js/134.32b0f3a6.js"><link rel="prefetch" href="/cypress-examples/assets/js/135.9a3e295b.js"><link rel="prefetch" href="/cypress-examples/assets/js/136.e87c483d.js"><link rel="prefetch" href="/cypress-examples/assets/js/137.9f6012a8.js"><link rel="prefetch" href="/cypress-examples/assets/js/138.de0cafea.js"><link rel="prefetch" href="/cypress-examples/assets/js/139.8790968a.js"><link rel="prefetch" href="/cypress-examples/assets/js/14.cd2146c9.js"><link rel="prefetch" href="/cypress-examples/assets/js/140.98363605.js"><link rel="prefetch" href="/cypress-examples/assets/js/141.2b2a722d.js"><link rel="prefetch" href="/cypress-examples/assets/js/142.d17ff68c.js"><link rel="prefetch" href="/cypress-examples/assets/js/143.e63a7d23.js"><link rel="prefetch" href="/cypress-examples/assets/js/144.0e79c14b.js"><link rel="prefetch" href="/cypress-examples/assets/js/145.590f4df3.js"><link rel="prefetch" href="/cypress-examples/assets/js/146.f6982dff.js"><link rel="prefetch" href="/cypress-examples/assets/js/147.db726c41.js"><link rel="prefetch" href="/cypress-examples/assets/js/148.923ad1d4.js"><link rel="prefetch" href="/cypress-examples/assets/js/149.41e0bc0b.js"><link rel="prefetch" href="/cypress-examples/assets/js/15.a0281882.js"><link rel="prefetch" href="/cypress-examples/assets/js/150.979a9193.js"><link rel="prefetch" href="/cypress-examples/assets/js/151.47ec27d8.js"><link rel="prefetch" href="/cypress-examples/assets/js/152.846ddd05.js"><link rel="prefetch" href="/cypress-examples/assets/js/153.37f9a800.js"><link rel="prefetch" href="/cypress-examples/assets/js/154.bd20ca24.js"><link rel="prefetch" href="/cypress-examples/assets/js/155.84595fb1.js"><link rel="prefetch" href="/cypress-examples/assets/js/156.40f86a47.js"><link rel="prefetch" href="/cypress-examples/assets/js/157.1fec5889.js"><link rel="prefetch" href="/cypress-examples/assets/js/158.2d87e7a4.js"><link rel="prefetch" href="/cypress-examples/assets/js/159.a2a36072.js"><link rel="prefetch" href="/cypress-examples/assets/js/16.b8129a4a.js"><link rel="prefetch" href="/cypress-examples/assets/js/160.a70d6854.js"><link rel="prefetch" href="/cypress-examples/assets/js/161.5e633755.js"><link rel="prefetch" href="/cypress-examples/assets/js/162.b3ff3878.js"><link rel="prefetch" href="/cypress-examples/assets/js/163.06175c6a.js"><link rel="prefetch" href="/cypress-examples/assets/js/164.0bf1433e.js"><link rel="prefetch" href="/cypress-examples/assets/js/165.0cf21ba7.js"><link rel="prefetch" href="/cypress-examples/assets/js/17.5a7dfd06.js"><link rel="prefetch" href="/cypress-examples/assets/js/18.ea59899a.js"><link rel="prefetch" href="/cypress-examples/assets/js/19.dbca67cd.js"><link rel="prefetch" href="/cypress-examples/assets/js/20.3da8d993.js"><link rel="prefetch" href="/cypress-examples/assets/js/21.18378a5e.js"><link rel="prefetch" href="/cypress-examples/assets/js/22.5c3ec696.js"><link rel="prefetch" href="/cypress-examples/assets/js/23.f208a22d.js"><link rel="prefetch" href="/cypress-examples/assets/js/24.38ad152d.js"><link rel="prefetch" href="/cypress-examples/assets/js/25.44fed4da.js"><link rel="prefetch" href="/cypress-examples/assets/js/26.23015281.js"><link rel="prefetch" href="/cypress-examples/assets/js/27.c781ad07.js"><link rel="prefetch" href="/cypress-examples/assets/js/29.fbe88229.js"><link rel="prefetch" href="/cypress-examples/assets/js/30.2fd4715f.js"><link rel="prefetch" href="/cypress-examples/assets/js/31.ccfe6dba.js"><link rel="prefetch" href="/cypress-examples/assets/js/32.e671456b.js"><link rel="prefetch" href="/cypress-examples/assets/js/33.01e95432.js"><link rel="prefetch" href="/cypress-examples/assets/js/34.fd76a060.js"><link rel="prefetch" href="/cypress-examples/assets/js/35.d5a571b4.js"><link rel="prefetch" href="/cypress-examples/assets/js/36.2882b3ef.js"><link rel="prefetch" href="/cypress-examples/assets/js/37.5bd4e2ad.js"><link rel="prefetch" href="/cypress-examples/assets/js/38.b99deeeb.js"><link rel="prefetch" href="/cypress-examples/assets/js/39.166c0afd.js"><link rel="prefetch" href="/cypress-examples/assets/js/4.6887f57b.js"><link rel="prefetch" href="/cypress-examples/assets/js/40.4132a33c.js"><link rel="prefetch" href="/cypress-examples/assets/js/41.1563a6c1.js"><link rel="prefetch" href="/cypress-examples/assets/js/42.ec297d32.js"><link rel="prefetch" href="/cypress-examples/assets/js/43.255c7cf7.js"><link rel="prefetch" href="/cypress-examples/assets/js/44.9e907c12.js"><link rel="prefetch" href="/cypress-examples/assets/js/45.f3ee2748.js"><link rel="prefetch" href="/cypress-examples/assets/js/46.dd68c510.js"><link rel="prefetch" href="/cypress-examples/assets/js/47.42e6a992.js"><link rel="prefetch" href="/cypress-examples/assets/js/48.d805010c.js"><link rel="prefetch" href="/cypress-examples/assets/js/49.c34e57fb.js"><link rel="prefetch" href="/cypress-examples/assets/js/5.3c37e658.js"><link rel="prefetch" href="/cypress-examples/assets/js/50.18977375.js"><link rel="prefetch" href="/cypress-examples/assets/js/51.791bce44.js"><link rel="prefetch" href="/cypress-examples/assets/js/52.e94c1470.js"><link rel="prefetch" href="/cypress-examples/assets/js/53.9a4e3d15.js"><link rel="prefetch" href="/cypress-examples/assets/js/54.dae17f52.js"><link rel="prefetch" href="/cypress-examples/assets/js/55.c139b996.js"><link rel="prefetch" href="/cypress-examples/assets/js/56.61d563e4.js"><link rel="prefetch" href="/cypress-examples/assets/js/57.d5c03196.js"><link rel="prefetch" href="/cypress-examples/assets/js/58.007c3a14.js"><link rel="prefetch" href="/cypress-examples/assets/js/59.5555ba24.js"><link rel="prefetch" href="/cypress-examples/assets/js/6.fb0c7654.js"><link rel="prefetch" href="/cypress-examples/assets/js/60.5370da33.js"><link rel="prefetch" href="/cypress-examples/assets/js/61.960414c7.js"><link rel="prefetch" href="/cypress-examples/assets/js/62.215b622e.js"><link rel="prefetch" href="/cypress-examples/assets/js/63.4343eecc.js"><link rel="prefetch" href="/cypress-examples/assets/js/64.b3704441.js"><link rel="prefetch" href="/cypress-examples/assets/js/65.c9f2892e.js"><link rel="prefetch" href="/cypress-examples/assets/js/66.e4bb04a0.js"><link rel="prefetch" href="/cypress-examples/assets/js/67.b05ab1f4.js"><link rel="prefetch" href="/cypress-examples/assets/js/68.238981f8.js"><link rel="prefetch" href="/cypress-examples/assets/js/69.41606cc9.js"><link rel="prefetch" href="/cypress-examples/assets/js/7.5f1b62f9.js"><link rel="prefetch" href="/cypress-examples/assets/js/70.862d48cb.js"><link rel="prefetch" href="/cypress-examples/assets/js/71.906218e7.js"><link rel="prefetch" href="/cypress-examples/assets/js/72.5e6098ca.js"><link rel="prefetch" href="/cypress-examples/assets/js/73.f67f0e64.js"><link rel="prefetch" href="/cypress-examples/assets/js/74.812cd344.js"><link rel="prefetch" href="/cypress-examples/assets/js/75.329d6137.js"><link rel="prefetch" href="/cypress-examples/assets/js/76.ab414c8f.js"><link rel="prefetch" href="/cypress-examples/assets/js/77.04ca874f.js"><link rel="prefetch" href="/cypress-examples/assets/js/78.848d0a21.js"><link rel="prefetch" href="/cypress-examples/assets/js/79.250e6984.js"><link rel="prefetch" href="/cypress-examples/assets/js/8.8a7a7300.js"><link rel="prefetch" href="/cypress-examples/assets/js/80.cb0806ec.js"><link rel="prefetch" href="/cypress-examples/assets/js/81.b66ca625.js"><link rel="prefetch" href="/cypress-examples/assets/js/82.4ead4f7c.js"><link rel="prefetch" href="/cypress-examples/assets/js/83.18359060.js"><link rel="prefetch" href="/cypress-examples/assets/js/84.432b521c.js"><link rel="prefetch" href="/cypress-examples/assets/js/85.b2f08b52.js"><link rel="prefetch" href="/cypress-examples/assets/js/86.440e2537.js"><link rel="prefetch" href="/cypress-examples/assets/js/87.52910308.js"><link rel="prefetch" href="/cypress-examples/assets/js/88.6cfc1e96.js"><link rel="prefetch" href="/cypress-examples/assets/js/89.b081a256.js"><link rel="prefetch" href="/cypress-examples/assets/js/9.fc1e4c2a.js"><link rel="prefetch" href="/cypress-examples/assets/js/90.abedb192.js"><link rel="prefetch" href="/cypress-examples/assets/js/91.275602be.js"><link rel="prefetch" href="/cypress-examples/assets/js/92.ba66706a.js"><link rel="prefetch" href="/cypress-examples/assets/js/93.f142e707.js"><link rel="prefetch" href="/cypress-examples/assets/js/94.231c4b3b.js"><link rel="prefetch" href="/cypress-examples/assets/js/95.e04ab021.js"><link rel="prefetch" href="/cypress-examples/assets/js/96.fb1c435b.js"><link rel="prefetch" href="/cypress-examples/assets/js/97.e1d5f00b.js"><link rel="prefetch" href="/cypress-examples/assets/js/98.9d986107.js"><link rel="prefetch" href="/cypress-examples/assets/js/99.3933f171.js"><link rel="prefetch" href="/cypress-examples/assets/js/vendors~docsearch.7e068240.js">
    <link rel="stylesheet" href="/cypress-examples/assets/css/0.styles.56615f06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cypress-examples/" class="home-link router-link-active"><!----> <span class="site-name">Cypress examples (v12.5.1)</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Commands" class="dropdown-title"><span class="title">Commands</span> <span class="arrow down"></span></button> <button type="button" aria-label="Commands" class="mobile-dropdown-title"><span class="title">Commands</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/querying/" class="nav-link">
  Querying
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/traversal/" class="nav-link">
  Traversal
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/actions/" class="nav-link">
  Actions
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/window/" class="nav-link">
  Window
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/viewport/" class="nav-link">
  Viewport
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/location/" class="nav-link">
  Location
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/navigation/" class="nav-link">
  Navigation
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/assertions/" class="nav-link">
  Assertions
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/misc/" class="nav-link">
  Misc
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/connectors/" class="nav-link">
  Connectors
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/aliasing/" class="nav-link">
  Aliasing
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/waiting/" class="nav-link">
  Waiting
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/network-requests/" class="nav-link">
  Network Requests
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/files/" class="nav-link">
  Files
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/local-storage/" class="nav-link">
  Local Storage
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/cookies/" class="nav-link">
  Cookies
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/spies-stubs-clocks/" class="nav-link">
  Spies, Stubs &amp; Clocks
</a></li></ul></div></div><div class="nav-item"><a href="/cypress-examples/utilities/" class="nav-link">
  Utilities
</a></div><div class="nav-item"><a href="/cypress-examples/cypress-api/" class="nav-link">
  Cypress API
</a></div> <a href="https://github.com/bahmutov/cypress-examples" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Commands" class="dropdown-title"><span class="title">Commands</span> <span class="arrow down"></span></button> <button type="button" aria-label="Commands" class="mobile-dropdown-title"><span class="title">Commands</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/querying/" class="nav-link">
  Querying
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/traversal/" class="nav-link">
  Traversal
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/actions/" class="nav-link">
  Actions
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/window/" class="nav-link">
  Window
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/viewport/" class="nav-link">
  Viewport
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/location/" class="nav-link">
  Location
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/navigation/" class="nav-link">
  Navigation
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/assertions/" class="nav-link">
  Assertions
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/misc/" class="nav-link">
  Misc
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/connectors/" class="nav-link">
  Connectors
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/aliasing/" class="nav-link">
  Aliasing
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/waiting/" class="nav-link">
  Waiting
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/network-requests/" class="nav-link">
  Network Requests
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/files/" class="nav-link">
  Files
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/local-storage/" class="nav-link">
  Local Storage
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/cookies/" class="nav-link">
  Cookies
</a></li><li class="dropdown-item"><!----> <a href="/cypress-examples/commands/spies-stubs-clocks/" class="nav-link">
  Spies, Stubs &amp; Clocks
</a></li></ul></div></div><div class="nav-item"><a href="/cypress-examples/utilities/" class="nav-link">
  Utilities
</a></div><div class="nav-item"><a href="/cypress-examples/cypress-api/" class="nav-link">
  Cypress API
</a></div> <a href="https://github.com/bahmutov/cypress-examples" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spies, Stubs &amp; Clocks</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cypress-examples/commands/spies-stubs-clocks.html#cy-spy" class="sidebar-link">cy.spy()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#spy-retries" class="sidebar-link">Spy retries</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#checking-the-call-arguments" class="sidebar-link">Checking the call arguments</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#matchers" class="sidebar-link">Matchers</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#call-count" class="sidebar-link">Call count</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#reset-call-count" class="sidebar-link">Reset call count</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#returned-value" class="sidebar-link">Returned value</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#resolved-value" class="sidebar-link">Resolved value</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#call-the-spy-from-the-test" class="sidebar-link">Call the spy from the test</a></li></ul></li><li><a href="/cypress-examples/commands/spies-stubs-clocks.html#cy-stub" class="sidebar-link">cy.stub()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#return-different-values-for-different-calls" class="sidebar-link">Return different values for different calls</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#return-different-dynamic-values" class="sidebar-link">Return different dynamic values</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#saving-stub-under-an-alias" class="sidebar-link">Saving stub under an alias</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#restore-a-stub" class="sidebar-link">Restore a stub</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#restore-a-stub-from-an-alias" class="sidebar-link">Restore a stub from an alias</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#matching-stub-depending-on-arguments" class="sidebar-link">Matching stub depending on arguments</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-a-property" class="sidebar-link">Stub a property</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-application-code" class="sidebar-link">Stub application code</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#call-the-original-method-from-the-stub" class="sidebar-link">Call the original method from the stub</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#check-the-order-of-calls" class="sidebar-link">Check the order of calls</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-window-open" class="sidebar-link">Stub window.open</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-window-alert" class="sidebar-link">Stub window.alert</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-window-prompt" class="sidebar-link">Stub window.prompt</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-a-method-and-restore" class="sidebar-link">Stub a method and restore</a></li><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#stub-and-call-the-argument-callback" class="sidebar-link">Stub and call the argument callback</a></li></ul></li><li><a href="/cypress-examples/commands/spies-stubs-clocks.html#cy-clock" class="sidebar-link">cy.clock()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cypress-examples/commands/spies-stubs-clocks.html#changes-the-application-clock-only" class="sidebar-link">Changes the application clock only</a></li></ul></li><li><a href="/cypress-examples/commands/spies-stubs-clocks.html#cy-tick" class="sidebar-link">cy.tick()</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cypress-examples/commands/spies-stubs-clocks.html#see-also" class="sidebar-link">See also</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spies-stubs-clocks"><a href="#spies-stubs-clocks" class="header-anchor">#</a> Spies, Stubs &amp; Clocks</h1> <p>Examples of using stubs, spies, and controlling clock time - for a full reference of commands, go to <a href="https://on.cypress.io/api" target="_blank" rel="noopener noreferrer">docs.cypress.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="cy-spy"><a href="#cy-spy" class="header-anchor">#</a> <a href="https://on.cypress.io/spy" target="_blank" rel="noopener noreferrer">cy.spy()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>To wrap a method in a spy, use the <code>cy.spy()</code> command.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> spy <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'anyArgs'</span><span class="token punctuation">)</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// assert against the spy directly</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>called
<span class="token comment">// or get the spy via its reference</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@anyArgs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.called'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="spy-retries"><a href="#spy-retries" class="header-anchor">#</a> Spy retries</h3> <p><code>cy.spy()</code> retries until the assertions that follow it pass.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">)</span>

cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledTwice'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="checking-the-call-arguments"><a href="#checking-the-call-arguments" class="header-anchor">#</a> Checking the call arguments</h3> <p>You can verify the spy or stub was called with expected arguments.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> first <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> last
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'setName'</span><span class="token punctuation">)</span>
<span class="token comment">// simulate the application calling the method</span>
<span class="token comment">// after some random delay</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">,</span> <span class="token string">'Smith'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token comment">// check if the spy was called</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.called'</span><span class="token punctuation">)</span>
<span class="token comment">// check if the spy was called exactly once</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledOnce'</span><span class="token punctuation">)</span>
<span class="token comment">// check if the spy was called with first argument 'Joe'</span>
<span class="token comment">// the call might have had more arguments, but we do not check them</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span> <span class="token string">'Joe'</span><span class="token punctuation">)</span>
<span class="token comment">// check if the spy was called with these arguments</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>
  <span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span>
  <span class="token string">'Joe'</span><span class="token punctuation">,</span>
  <span class="token string">'Smith'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token comment">// check if the spy was called once with a string and &quot;Smith&quot;</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@setName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>
  <span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
  <span class="token string">'Smith'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token comment">// verify the property was set</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.property'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Joe Smith'</span><span class="token punctuation">)</span>
</code></pre></div> <p>For matching objects in the arguments, see the recipe <a href="/cypress-examples/recipes/called-with-object.html">Spy called with an object</a>.</p> <h3 id="matchers"><a href="#matchers" class="header-anchor">#</a> Matchers</h3> <p><code>cy.spy</code> and <code>cy.stub</code> match call arguments using <a href="https://sinonjs.org/releases/latest/matchers/" target="_blank" rel="noopener noreferrer">Sinon matchers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// see all possible matchers at</span>
<span class="token comment">// https://sinonjs.org/releases/latest/matchers/</span>
<span class="token keyword">const</span> calculator <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * returns the sum of two arguments
   * @param a {number}
   * @param b {number}
   */</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> spy <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>calculator<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>calculator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">// if we want to assert the exact values used during the call</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">// let's confirm &quot;add&quot; method was called with two numbers</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// alternatively, provide the value to match</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// match any value</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>any<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">// match any value from a list</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">/**
 * Returns true if the given number is event
 * @param {number} x
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isEven</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span>

<span class="token comment">// expect the value to pass a custom predicate function</span>
<span class="token comment">// the second argument to &quot;sinon.match(predicate, message)&quot; is</span>
<span class="token comment">// shown if the predicate does not pass and assertion fails</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>isEven<span class="token punctuation">,</span> <span class="token string">'isEven'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">/**
 * Returns a function that checks if a given number is larger than the limit
 * @param {number} limit
 * @returns {(x: number) =&gt; boolean}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isGreaterThan</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">&gt;</span> limit

<span class="token comment">/**
 * Returns a function that checks if a given number is less than the limit
 * @param {number} limit
 * @returns {(x: number) =&gt; boolean}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isLessThan</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">&lt;</span> limit

<span class="token comment">// you can combine several matchers using &quot;and&quot;, &quot;or&quot;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon
    <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token function">isGreaterThan</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&gt; 2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&lt; 4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon
    <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token function">isGreaterThan</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&gt; 200'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// matchers can be used from BDD assertions</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>
  <span class="token string">'have.been.calledWith'</span><span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// you can alias matchers for shorter test code</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">match</span><span class="token operator">:</span> <span class="token constant">M</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Cypress<span class="token punctuation">.</span>sinon

cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledWith'</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">.</span>number<span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="call-count"><a href="#call-count" class="header-anchor">#</a> Call count</h3> <p>A spy is just an object. You can access and assert its individual properties using <a href="https://on.cypress.io/its" target="_blank" rel="noopener noreferrer">.its<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> command.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>greet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Log greeting<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// note to make things more interesting</span>
  <span class="token comment">// we will log the message asynchronously</span>
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'greet'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Happy Testing!'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="greet">Log greeting</button> <script>
  // note to make things more interesting
  // we will log the message asynchronously
  document
    .getElementById('greet')
    .addEventListener('click', function () {
      setTimeout(function () {
        console.log('Happy Testing!')
      }, 200)
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// first, let's spy on the console.log method</span>
cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">console</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// second, act on the UI</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#greet'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// third assert the spy was called three times</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@log'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'callCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'eq'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="reset-call-count"><a href="#reset-call-count" class="header-anchor">#</a> Reset call count</h3> <p>You can reset a spy / stub using the <code>.resetHistory</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test subject</span>
<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// spy on the subject's method</span>
cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'birthday'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// the application calls the method twice</span>
    person<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    person<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// verify the spy recorded two calls</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledTwice'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    person<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    person<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'callCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'**reset history**'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'resetHistory'</span><span class="token punctuation">)</span>
<span class="token comment">// the spy call count and the history have been cleared</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'callCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@birthday'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'not.have.been.called'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="returned-value"><a href="#returned-value" class="header-anchor">#</a> Returned value</h3> <p>We can check the value returned by the method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> calc <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>calc<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.returned'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment">// if there are several calls</span>
calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token comment">// the assertion will pass if at least one returned 3</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.returned'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="resolved-value"><a href="#resolved-value" class="header-anchor">#</a> Resolved value</h3> <p>We can check the value returned by the method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> calc <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token keyword">await</span> Cypress<span class="token punctuation">.</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> sum
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>calc<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span>
<span class="token comment">// wait for the promise to resolve</span>
<span class="token comment">// then confirm its resolved value</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment">// make a few more calls</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token comment">// example of confirming one of the calls used add(4, 5)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledWith'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment">// now let's confirm the resolved values</span>
<span class="token comment">// first we need to wait for all promises to resolve</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@add'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'returnValues'</span><span class="token punctuation">)</span>
  <span class="token comment">// yields N promises, let's wait for them to resolve</span>
  <span class="token comment">// in this test they should be resolved already</span>
  <span class="token comment">// since we used cy.wrap() individually</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// alternative: to avoid the wrong &quot;this&quot; value when using Promise.all</span>
  <span class="token comment">// .then((ps) =&gt; Promise.all(ps))</span>
  <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'deep.equal'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="call-the-spy-from-the-test"><a href="#call-the-spy-from-the-test" class="header-anchor">#</a> Call the spy from the test</h3> <p>When spying on the object's method typically you call the method. If you do call the created spy function, it does not have the <code>this</code> pointing at the original object. You can bind the <code>this</code> to point to the object by using <code>.bind</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> testRunner <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Cypress'</span><span class="token punctuation">,</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getNameSpy <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>testRunner<span class="token punctuation">,</span> <span class="token string">'getName'</span><span class="token punctuation">)</span>
<span class="token comment">// the created spy is just a function</span>
<span class="token function">expect</span><span class="token punctuation">(</span>getNameSpy<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token string">'function'</span><span class="token punctuation">)</span>
<span class="token comment">// call the object's method</span>
<span class="token function">expect</span><span class="token punctuation">(</span>testRunner<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'object.method'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Cypress'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>getNameSpy<span class="token punctuation">,</span> <span class="token string">'method was called'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>calledOnce
<span class="token function">expect</span><span class="token punctuation">(</span>
  <span class="token function">getNameSpy</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>testRunner<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'call the spy directly'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Cypress'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>getNameSpy<span class="token punctuation">,</span> <span class="token string">'method was called twice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>calledTwice
</code></pre></div> <p>Watch the video <a href="https://youtu.be/g_7LZXuEIMA" target="_blank" rel="noopener noreferrer">How To Call The Spy Function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="cy-stub"><a href="#cy-stub" class="header-anchor">#</a> <a href="https://on.cypress.io/stub" target="_blank" rel="noopener noreferrer">cy.stub()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>To create a stub and/or replace a function with a stub, use the <code>cy.stub()</code> command.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * prints both arguments to the console
   * @param a {string}
   * @param b {string}
   */</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// eslint-disable-next-line no-console</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stub <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>stub<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>called
</code></pre></div> <h3 id="return-different-values-for-different-calls"><a href="#return-different-values-for-different-calls" class="header-anchor">#</a> Return different values for different calls</h3> <p>If you want to return one value on the first call, then another value on the second call, etc</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fav-color<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Ask about color<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>color-output<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fav-color'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'What is your favorite color?'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'color-output'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> color
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="fav-color">Ask about color</button> <div id="color-output"></div> <script>
  document
    .getElementById('fav-color')
    .addEventListener('click', function () {
      const color = window.prompt('What is your favorite color?')
      document.getElementById('color-output').innerText = color
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// see how to use Sinon stubs</span>
  <span class="token comment">// https://sinonjs.org/releases/v10.0.0/stubs/</span>
  cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">'prompt'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">onFirstCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">onSecondCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>
    <span class="token comment">// after the first 2 calls, always return purple</span>
    <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'purple'</span><span class="token punctuation">)</span>
    <span class="token comment">// give the stub an alias</span>
    <span class="token comment">// so we can check the number of calls later</span>
    <span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'color-stub'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-color'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#color-output'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-color'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#color-output'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-color'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#color-output'</span><span class="token punctuation">,</span> <span class="token string">'purple'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@color-stub'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.property'</span><span class="token punctuation">,</span> <span class="token string">'callCount'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="return-different-dynamic-values"><a href="#return-different-dynamic-values" class="header-anchor">#</a> Return different dynamic values</h3> <p>If you want to return one value on the first call, then another value on the second call, etc and the return values come from an array, you cannot use <code>stub.onFirstCall</code>, <code>stub.onSecondCall</code>, etc. Instead use <code>stub.onCall(k)</code> method</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fav-colors<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Ask about color<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>colors-output<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fav-colors'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'What is your favorite color?'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'colors-output'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> color
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="fav-colors">Ask about color</button> <div id="colors-output"></div> <script>
  document
    .getElementById('fav-colors')
    .addEventListener('click', function () {
      const color = window.prompt('What is your favorite color?')
      document.getElementById('colors-output').innerText = color
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">]</span>

  <span class="token comment">// see how to use Sinon stubs</span>
  <span class="token comment">// https://sinonjs.org/releases/v10.0.0/stubs/</span>
  <span class="token keyword">const</span> s <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">'prompt'</span><span class="token punctuation">)</span>
  colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">.</span><span class="token function">onCall</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// after that always return purple</span>
  s<span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'purple'</span><span class="token punctuation">)</span>
    <span class="token comment">// give the stub an alias</span>
    <span class="token comment">// so we can check the number of calls later</span>
    <span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'colors-stub'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-colors'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#colors-output'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-colors'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#colors-output'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#fav-colors'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'#colors-output'</span><span class="token punctuation">,</span> <span class="token string">'purple'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@colors-stub'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.property'</span><span class="token punctuation">,</span> <span class="token string">'callCount'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="saving-stub-under-an-alias"><a href="#saving-stub-under-an-alias" class="header-anchor">#</a> Saving stub under an alias</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span>

<span class="token comment">// access the stub using alias</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.called'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="restore-a-stub"><a href="#restore-a-stub" class="header-anchor">#</a> Restore a stub</h3> <p>When you no longer want to use the stub, call <code>.restore()</code> method on the stub</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Joe'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'true name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'getName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'Cliff'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mock name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Cliff'</span><span class="token punctuation">)</span>
<span class="token comment">// restore the original method</span>
person<span class="token punctuation">.</span>getName<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'restored name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="restore-a-stub-from-an-alias"><a href="#restore-a-stub-from-an-alias" class="header-anchor">#</a> Restore a stub from an alias</h3> <p>You can also restore the original method from its alias</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Joe'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'true name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'getName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'Cliff'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'getName'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mock name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Cliff'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@getName'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledOnce'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'restore'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'restored name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="matching-stub-depending-on-arguments"><a href="#matching-stub-depending-on-arguments" class="header-anchor">#</a> Matching stub depending on arguments</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// see all possible matchers at</span>
<span class="token comment">// https://sinonjs.org/releases/latest/matchers/</span>
<span class="token keyword">const</span> greeter <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * Greets a person
   * @param {string} name
   */</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stub <span class="token operator">=</span> cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>greeter<span class="token punctuation">,</span> <span class="token string">'greet'</span><span class="token punctuation">)</span>
<span class="token comment">// all non-matched calls should call the real method</span>
stub<span class="token punctuation">.</span><span class="token function">callThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// all calls with a string argument should get &quot;Hi&quot;</span>
stub<span class="token punctuation">.</span><span class="token function">withArgs</span><span class="token punctuation">(</span>Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
<span class="token comment">// all calls with a number argument should raise an error</span>
stub
  <span class="token punctuation">.</span><span class="token function">withArgs</span><span class="token punctuation">(</span>Cypress<span class="token punctuation">.</span>sinon<span class="token punctuation">.</span>match<span class="token punctuation">.</span>number<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// let us confirm the stub is working</span>
<span class="token comment">// case 1: if we call it with a string argument</span>
<span class="token comment">// it returns &quot;Hi&quot;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
<span class="token comment">// case 2: if we call it with a number argument</span>
<span class="token comment">// it raises an error</span>
<span class="token comment">// @ts-ignore</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">'Invalid name'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span>greet<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>have<span class="token punctuation">.</span>been<span class="token punctuation">.</span>calledTwice

<span class="token comment">// case 3: non-matched calls invoke the actual method</span>
<span class="token comment">// @ts-ignore</span>
<span class="token function">expect</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Hello, undefined!'</span><span class="token punctuation">)</span>
</code></pre></div><p>Watch the video <a href="https://youtu.be/ILZfNnheFDk" target="_blank" rel="noopener noreferrer">Stub A Method Depending On The Call Arguments<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Read the blog post <a href="https://glebbahmutov.com/blog/lock-down-sinon-stub/" target="_blank" rel="noopener noreferrer">Lock Down Sinon Stub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="stub-a-property"><a href="#stub-a-property" class="header-anchor">#</a> Stub a property</h3> <p>If we want to temporarily replace an object's property (not a method), we can use <code>.value</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Joe'</span><span class="token punctuation">,</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'real name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
<span class="token comment">// change the property using cy.stub</span>
cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">'Mike'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'stub name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Mike'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="stub-application-code"><a href="#stub-application-code" class="header-anchor">#</a> Stub application code</h3> <p>If you want to stub a method deep inside the application's code, access it using App Actions by passing the object reference via <code>window</code> object.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alerter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Alert me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">alertTheUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'📣 you clicked the button'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'alerter'</span><span class="token punctuation">)</span>
    <span class="token comment">// 🛑 it is important to NOT pass the method but call the method on click</span>
    <span class="token comment">// THIS WILL NOT WORK</span>
    <span class="token comment">// .addEventListener('click', actions.alertTheUser)</span>
    <span class="token comment">//</span>
    <span class="token comment">// ✅ This will work.</span>
    <span class="token comment">// If the &quot;alertsTheUser&quot; method is replaced in the &quot;actions&quot; object</span>
    <span class="token comment">// then the stub is called during test</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      actions<span class="token punctuation">.</span><span class="token function">alertTheUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// if we are running inside Cypress test</span>
  <span class="token comment">// expose the object with methods to be stubbed from tests</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Cypress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'running inside Cypress'</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span>actions <span class="token operator">=</span> actions
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'not running inside Cypress'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="alerter">Alert me</button> <script>
  const actions = {
    alertTheUser() {
      alert('📣 you clicked the button')
    },
  }
  document
    .getElementById('alerter')
    // 🛑 it is important to NOT pass the method but call the method on click
    // THIS WILL NOT WORK
    // .addEventListener('click', actions.alertTheUser)
    //
    // ✅ This will work.
    // If the &quot;alertsTheUser&quot; method is replaced in the &quot;actions&quot; object
    // then the stub is called during test
    .addEventListener('click', function () {
      actions.alertTheUser()
    })

  // if we are running inside Cypress test
  // expose the object with methods to be stubbed from tests
  if (window.Cypress) {
    console.log('running inside Cypress')
    window.actions = actions
  } else {
    console.log('not running inside Cypress')
  }
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'actions'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">actions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>actions<span class="token punctuation">,</span> <span class="token string">'alertTheUser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'alerted'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#alerter'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@alerted'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.called'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="call-the-original-method-from-the-stub"><a href="#call-the-original-method-from-the-stub" class="header-anchor">#</a> Call the original method from the stub</h3> <p>Sometimes you might want to call the original method from the stub.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Joe'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'getName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">callsFake</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// call the real person.getName()</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    person<span class="token punctuation">.</span>getName
      <span class="token punctuation">.</span><span class="token function">wrappedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// but then reverse the returned string</span>
      <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'eoJ'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="check-the-order-of-calls"><a href="#check-the-order-of-calls" class="header-anchor">#</a> Check the order of calls</h3> <p>You can check if one stub was called before or after another stub.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cart <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'initialized'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'finalized'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> <span class="token string">'init'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> <span class="token string">'finalize'</span><span class="token punctuation">)</span>
cart<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// confirm the &quot;init&quot; method was called before the &quot;finalize&quot; method</span>
<span class="token function">expect</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>have<span class="token punctuation">.</span>been<span class="token punctuation">.</span><span class="token function">calledBefore</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span>finalize<span class="token punctuation">)</span>
</code></pre></div> <h3 id="stub-window-open"><a href="#stub-window-open" class="header-anchor">#</a> Stub window.open</h3> <p>If an application tries to open a second tab by calling <code>window.open(url, ...)</code>, you must <a href="https://glebbahmutov.com/blog/cypress-second-tab/" target="_blank" rel="noopener noreferrer">prevent it<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Let's stub the method <code>open</code> and check the arguments after the call.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>help<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Show help<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'help'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'/help'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="help">Show help</button> <script>
  document
    .getElementById('help')
    .addEventListener('click', function () {
      open('/help', '_blank')
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">win</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>win<span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token string">'Show help'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// confirm the call arguments</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@open'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledWith'</span><span class="token punctuation">,</span> <span class="token string">'/help'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span>
</code></pre></div><p>Watch the video <a href="https://youtu.be/zPLr_YHZckU" target="_blank" rel="noopener noreferrer">Stub Window Open Method And Confirm The Call Arguments<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="stub-window-alert"><a href="#stub-window-alert" class="header-anchor">#</a> Stub window.alert</h3> <p>If the application is using <code>window.alert</code> to show short messages to the user, you can use <code>cy.stub</code> to intercept those calls and avoid blocking the test runner.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sayhi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'sayhi'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello there!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="sayhi">Click me</button> <script>
  document
    .getElementById('sayhi')
    .addEventListener('click', function () {
      alert('Hello there!')
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">win</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>win<span class="token punctuation">,</span> <span class="token string">'alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'alert'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#sayhi'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>
  <span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span>
  <span class="token string">'Hello there!'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token comment">// the application can trigger the alert several times</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#sayhi'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// we can confirm the total number of calls</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'callCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="stub-window-prompt"><a href="#stub-window-prompt" class="header-anchor">#</a> Stub window.prompt</h3> <p>If the application is asking the user for simple information using <code>window.prompt</code>, you can use <code>cy.stub</code> to respond with a test answer.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>greet-by-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Greet me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'greet-by-name'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'What is your name?'</span><span class="token punctuation">)</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><button id="greet-by-name">Greet me</button> <script>
  document
    .getElementById('greet-by-name')
    .addEventListener('click', function () {
      const name = prompt('What is your name?')
      alert('Hello ' + name)
    })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">win</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>win<span class="token punctuation">,</span> <span class="token string">'prompt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'Cy'</span><span class="token punctuation">)</span>
  cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>win<span class="token punctuation">,</span> <span class="token string">'alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'alert'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#greet-by-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span> <span class="token string">'Hello Cy'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="stub-a-method-and-restore"><a href="#stub-a-method-and-restore" class="header-anchor">#</a> Stub a method and restore</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Joe'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'before stub'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
<span class="token comment">// return &quot;Anna&quot; on the first call</span>
<span class="token comment">// all calls after that will return &quot;undefined&quot;</span>
cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onFirstCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token string">'Anna'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'first stubbed call'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Anna'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'second stubbed call'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'restored method'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'Joe'</span><span class="token punctuation">)</span>
</code></pre></div> <p>Note: all Cypress stubs and spies are restored automatically before each test.</p> <h3 id="stub-and-call-the-argument-callback"><a href="#stub-and-call-the-argument-callback" class="header-anchor">#</a> Stub and call the argument callback</h3> <p>If the stubbed method expects a callback function to be called, Sinon has a helper for that.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token parameter">onSuccess<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// if writing fails, the app calls &quot;onError&quot;</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'fs.writeFile failed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let's stub the <code>fs.writeFile</code> method to simulate an error.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> testError <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'A test error'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> <span class="token string">'writeFile'</span><span class="token punctuation">)</span>
  <span class="token comment">// we &quot;implement&quot; the same principle in our stub</span>
  <span class="token comment">// it should call the &quot;onError&quot; function</span>
  <span class="token comment">// which is the call's argument at position index 1</span>
  <span class="token punctuation">.</span><span class="token function">callsArgWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> testError<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'writeFile'</span><span class="token punctuation">)</span>
<span class="token comment">// call the application code</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'onSuccess'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cy<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">'onError'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// and confirm the expected calls were made</span>
<span class="token comment">// first check the positive assertion</span>
<span class="token comment">// then the negative one</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@onError'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.been.calledOnceWith'</span><span class="token punctuation">,</span> testError<span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'@onSuccess'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'not.have.been.called'</span><span class="token punctuation">)</span>
</code></pre></div> <p>See another example in the recipe <a href="/cypress-examples/recipes/stub-geolocation.html">Stub Geolocation</a>.</p> <h2 id="cy-clock"><a href="#cy-clock" class="header-anchor">#</a> <a href="https://on.cypress.io/clock" target="_blank" rel="noopener noreferrer">cy.clock()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>To control time in the browser, use the <code>cy.clock()</code> command.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>clock-div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  Click for current time!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#clock-div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> $div <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
    <span class="token comment">// seconds from the unix epoch</span>
    $div<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><div id="clock-div">
  Click for current time!
</div> <script>
  $('#clock-div').on('click', function (e) {
    let $div = $(e.currentTarget)
    // seconds from the unix epoch
    $div.text(new Date().getTime() / 1000)
  })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// create the date in UTC so its always the same</span>
<span class="token comment">// no matter what local timezone the browser is running in</span>
<span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

cy<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#clock-div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.text'</span><span class="token punctuation">,</span> <span class="token string">'1489449600'</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="changes-the-application-clock-only"><a href="#changes-the-application-clock-only" class="header-anchor">#</a> Changes the application clock only</h3> <p>When running Cypress tests, the tests themselves are outside the application's iframe. When you use <code>cy.clock()</code> command you change the application clock, and not the spec's clock.</p> <p>Fist, let's show that the two <code>Date</code> constructors are different between the application and the spec iframes.</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'not.equal'</span><span class="token punctuation">,</span> Date<span class="token punctuation">)</span>
</code></pre></div><p>Now let's confirm that <code>cy.clock()</code> controls the application's <code>Date</code>, but not the spec <code>Date</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> specNow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token comment">// sets the application clock and pause time</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// spec clock keeps ticking</span>
    <span class="token keyword">const</span> specNow2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// confirm by comparing the timestamps in milliseconds</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token operator">+</span>specNow2<span class="token punctuation">,</span> <span class="token string">'spec timestamps'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span>
      <span class="token operator">+</span>specNow<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// but the application's time is frozen</span>
cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">appDate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> appNow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">appDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token operator">+</span>appNow<span class="token punctuation">,</span> <span class="token string">'application timestamps'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token operator">+</span>now<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>and<span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1489449600000</span><span class="token punctuation">)</span> <span class="token comment">// the timestamp in milliseconds</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// we can advance the application clock by 5 seconds</span>
cy<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">its</span><span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">appDate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> appNow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">appDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>
      <span class="token operator">+</span>appNow<span class="token punctuation">,</span>
      <span class="token string">'timestamp after 5 synthetic seconds'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1489449605000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// meanwhile the spec clock only advanced by probably less than 200ms</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> specNow3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>
      <span class="token operator">+</span>specNow3<span class="token punctuation">,</span>
      <span class="token string">'elapsed on the spec clock'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">lessThan</span><span class="token punctuation">(</span><span class="token operator">+</span>specNow <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div> <h2 id="cy-tick"><a href="#cy-tick" class="header-anchor">#</a> <a href="https://on.cypress.io/tick" target="_blank" rel="noopener noreferrer">cy.tick()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>To move time in the browser, use the <code>cy.tick()</code> command.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tick-div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  Click for current time!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tick-div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> $div <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
    <span class="token comment">// seconds from the unix epoch</span>
    $div<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="example"><div id="tick-div">
  Click for current time!
</div> <script>
  $('#tick-div').on('click', function (e) {
    let $div = $(e.currentTarget)
    // seconds from the unix epoch
    $div.text(new Date().getTime() / 1000)
  })
</script></div></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// create the date in UTC so its always the same</span>
<span class="token comment">// no matter what local timezone the browser is running in</span>
<span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

cy<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#tick-div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.text'</span><span class="token punctuation">,</span> <span class="token string">'1489449600'</span><span class="token punctuation">)</span>
cy<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token comment">// 10 seconds passed</span>
cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#tick-div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.text'</span><span class="token punctuation">,</span> <span class="token string">'1489449610'</span><span class="token punctuation">)</span>
</code></pre></div> <h2 id="see-also"><a href="#see-also" class="header-anchor">#</a> See also</h2> <ul><li>Read the blog post <a href="https://glebbahmutov.com/blog/spy-on-complex-method-call/" target="_blank" rel="noopener noreferrer">Spy On A Complex Method Call<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/bahmutov/cypress-examples/edit/master/docs/commands/spies-stubs-clocks.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/cypress-examples/assets/js/app.936f9c65.js" defer></script><script src="/cypress-examples/assets/js/3.c5f790ff.js" defer></script><script src="/cypress-examples/assets/js/28.5f523ed4.js" defer></script>
  </body>
</html>
